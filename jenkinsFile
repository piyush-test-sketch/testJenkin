pipeline {
   agent any 
    stages {
        stage('checkout code') {
            steps {
                // Fetch code from the repository
                checkout scm
            }
        }
        stage('Install Dependencies') {
            steps {
                // Install project dependencies
                sh 'npm install'
            }
        }
        stage('Run Cypress Tests') {
            steps {
                // Run Cypress tests
                sh 'npx cypress run'
            }
        }
    }
    post {
        always {
            // Archive test results
            archiveArtifacts artifacts: 'cypress/screenshots/**, cypress/videos/**'
        }
        success {
            // Notify success
            emailext (
                subject: "Build #${BUILD_NUMBER} - Success",
                body: "Cypress tests completed successfully.\nBuild URL: ${BUILD_URL}",
                to: 'team@example.com'
            )
        }
        failure {
            // Notify failure
            emailext (
                subject: "Build #${BUILD_NUMBER} - Failure",
                body: "Cypress tests failed.\nBuild URL: ${BUILD_URL}",
                to: 'piyush.jamwal@avisoft.io'
            )
        }
    }
}
